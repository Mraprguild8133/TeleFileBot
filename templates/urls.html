{% extends "base.html" %}

{% block title %}URLs - Mraprguild Bot{% endblock %}
{% block page_title %}URL Management{% endblock %}

{% block content %}
<div class="page-content">
    <div class="page-header">
        <div class="header-info">
            <h2>ðŸ“Ž Shortened URLs</h2>
            <p>Manage and monitor all shortened URLs</p>
        </div>
        <div class="header-actions">
            <button class="action-btn primary" onclick="refreshData()">
                <i class="fas fa-sync-alt"></i>
                Refresh
            </button>
        </div>
    </div>

    <div class="data-table">
        <table>
            <thead>
                <tr>
                    <th>Original URL</th>
                    <th>Short Code</th>
                    <th>Clicks</th>
                    <th>Creator</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for url in urls %}
                <tr>
                    <td>
                        <div class="url-cell">
                            <i class="fas fa-external-link-alt"></i>
                            <span class="url-text" title="{{ url[1] }}">
                                {{ url[1][:60] }}{% if url[1]|length > 60 %}...{% endif %}
                            </span>
                        </div>
                    </td>
                    <td>
                        <div class="code-cell">
                            <code>{{ url[0] }}</code>
                            <button class="copy-btn" onclick="copyToClipboard('{{ url[0] }}')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </td>
                    <td>
                        <span class="click-count">{{ url[2] }}</span>
                    </td>
                    <td>
                        <div class="user-cell">
                            <i class="fas fa-user"></i>
                            {{ url[4] or 'Unknown' }}
                            {% if url[5] %}
                                <small>@{{ url[5] }}</small>
                            {% endif %}
                        </div>
                    </td>
                    <td>{{ url[3][:16] if url[3] else 'Unknown' }}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn small danger" onclick="deleteUrl('{{ url[0] }}')">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="action-btn small secondary" onclick="viewStats('{{ url[0] }}')">
                                <i class="fas fa-chart-line"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function copyToClipboard(shortCode) {
    navigator.clipboard.writeText(`https://short.ly/${shortCode}`);
    showNotification('Short URL copied to clipboard!', 'success');
}

function deleteUrl(shortCode) {
    if (confirm('Are you sure you want to delete this URL?')) {
        fetch('/api/delete_url', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `short_code=${shortCode}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('URL deleted successfully!', 'success');
                location.reload();
            } else {
                showNotification('Error deleting URL: ' + data.error, 'error');
            }
        });
    }
}

function viewStats(shortCode) {
    showNotification('Stats feature coming soon!', 'info');
}

function refreshData() {
    location.reload();
}
</script>
{% endblock %}